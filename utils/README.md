# Utility scripts

This directory contains scripts used to collate the data generated by
well-mixed and vertex simulations into comma-separated values (csv) files.

## Well-mixed simulations

If a well-mixed simulation script is run without a range argument, then the
generated csv file contains the data of all simulations and no further action
is needed.

If, on the other hand, the well-mixed simulation script is run with a range
argument, then the generated csv file contains only the data for a subset of
simulations.

```
$ cd sims/ch5-exponential-proliferation-regimes
$ python3 run-well-mixed-exponential-proliferation-regimes 0 0 10
$ ls *.csv
exponential-proliferation-regimes-data-00000-to-00010.csv
```

Splitting up the simulation suite in this way generates many csv files, one for
each invocation of the simulation script.

```
$ python3 run-well-mixed-exponential-proliferation-regimes 0 10 20
$ python3 run-well-mixed-exponential-proliferation-regimes 0 20 30
$ ls *.csv
exponential-proliferation-regimes-data-00000-to-00010.csv
exponential-proliferation-regimes-data-00010-to-00020.csv
exponential-proliferation-regimes-data-00020-to-00030.csv
```

The script `merge-csv-files.py` is provided here to combine these partial csv
files into a single csv file.

```
$ python3 ../../utils/merge-csv-files.py *.csv > data.csv
```

## Vertex simulations

Running a vertex simulation script outputs data in Chaste's test output
directory.  This is set from the environment variable `CHASTE_TEST_OUTPUT`, and
defaults to `/tmp/$USER/testoutput` if it is not set
([source](https://chaste.cs.ox.ac.uk/public-docs/classOutputFileHandler.html#a0f5e0618de55107606ee23a5d60c0b41)).

```
$ cd sims/ch6-heterotypic-survival-difference
$ bash run-vertex-heterotypic-survival-difference.sh 0
$ bash run-vertex-heterotypic-survival-difference.sh 1
$ bash run-vertex-heterotypic-survival-difference.sh 2
$ ls $CHASTE_TEST_OUTPUT/heterotypic_survival_difference/
betaA_0.50_tGA_100.00_etaA_0.10_coefA_1.00_betaB_0.10_tGB_100.00_etaB_0.02_coefB_1.00_Nx_10_Ny_10_pattern_segregated_sim_0
betaA_0.50_tGA_100.00_etaA_0.10_coefA_1.00_betaB_0.10_tGB_100.00_etaB_0.02_coefB_1.00_Nx_10_Ny_10_pattern_segregated_sim_1
betaA_0.50_tGA_100.00_etaA_0.10_coefA_1.00_betaB_0.10_tGB_100.00_etaB_0.02_coefB_1.00_Nx_10_Ny_10_pattern_segregated_sim_2
```

Each simulation writes its data to a simulation directory under the parent test
directory.  In this example, the test directory is
`$CHASTE_TEST_OUTPUT/heterotypic_survival_difference`.

The script `summarise-simulation-data.py` is provided here to extract and
collate the relevant data from these simulation data.

```
$ cd ../../utils
$ python3 summarise-simulation-data.py
Usage: summarise-simulation-data.py TEST_DIR [KEY_LIST] [SORT_BY_KEY]
TEST_DIR       is the test directory
KEY_LIST       is a comma-separated list of keys to output
               By default, all keys are outputted
SORT_BY_KEY    is the key by which to sort the simulations
               The field to sort by must be convertible to a float
               By default, the simulations are sorted by 'sim'
$ python3 summarise-simulation-data.py $CHASTE_TEST_OUTPUT/heterotypic_survival_difference > data.csv
```
